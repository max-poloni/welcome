<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8T173410KK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-8T173410KK');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
    <link rel="stylesheet" href="styless-main.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const firebaseConfig = {
            apiKey: "API_KEY",
            authDomain: "beer-58b91.firebaseapp.com",
            databaseURL: "https://beer-58b91-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "beer-58b91",
            storageBucket: "beer-58b91.appspot.com",
            messagingSenderId: "MESSAGING_SENDER_ID",
            appId: "APP_ID"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
        function loadUserData() {
            const username = localStorage.getItem('currentUser');
            if (username) {
                const userRef = database.ref('users/' + username);

                userRef.once('value').then((snapshot) => {
                    let userData = snapshot.val();
                    if (userData) {
                        if (!userData.balance) {
                            userData.balance = 10;
                            userRef.update({ balance: userData.balance });
                        }
                        document.getElementById('username').innerText = `Username: ${username}`;
                        document.getElementById('balance').innerHTML = `–ë–∞–ª–∞–Ω—Å: ${userData.balance} üç∫`;
                    } else {
                        document.getElementById('username').innerText = 'Username: –ì–æ—Å—Ç—å';
                        document.getElementById('balance').innerText = '–ë–∞–ª–∞–Ω—Å: 0 üç∫';
                    }
                });
            } else {
                document.getElementById('username').innerText = 'Username: –ì–æ—Å—Ç—å';
                document.getElementById('balance').innerText = '–ë–∞–ª–∞–Ω—Å: 0 üç∫';
            }
        }

        // –í—ã–∑—ã–≤–∞–µ–º —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function () {
            loadUserData();
            loadGames();
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function openModal(gameName) {
            const modal = document.getElementById('gameModal');
            modal.style.display = 'block';
            if (gameName === 'Beer Collect') {
                loadGame1();
            } else {
                document.getElementById('modalContent').innerText = `–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ ${gameName}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Game 1
        function loadGame1() {
            const modalContent = document.getElementById('modalContent');
            fetch('game1.html')
                .then(response => response.text())
                .then(data => {
                    modalContent.innerHTML = data;
                    // –í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –∏–∑ game1.html
                    const script = modalContent.querySelector('script');
                    if (script) {
                        eval(script.textContent);
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ game1.html:', error));
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('gameModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        function loadGames() {
            const gamesRef = database.ref('games');
            gamesRef.once('value').then((snapshot) => {
                const gamesContainer = document.querySelector('.slider');
                gamesContainer.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const gameData = childSnapshot.val();
                    console.log(gameData);
                    const gameCard = document.createElement('div');
                    gameCard.className = 'game-card';
                    gameCard.onclick = () => openModal(gameData.name);

                    const avatarUrl = gameData.avatar || 'default_avatar.jpg';
                    const activePlayers = gameData.activePlayers || 0;

                    gameCard.innerHTML = `
                        <img src="${avatarUrl}" alt="${gameData.name}">
                        <h3>${gameData.name}</h3>
                        <p>–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä–æ–∫–∏: ${activePlayers}</p>
                    `;
                    gamesContainer.appendChild(gameCard);
                });

                if (snapshot.numChildren() === 0) {
                    console.log("–ò–≥—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.");
                }
            }).catch((error) => {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–≥—Ä:", error);
            });
        }
    </script>
</head>
<body>
<header>
    <h1>Games</h1>
    <div id="username">Username: –ì–æ—Å—Ç—å</div>
    <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 üç∫</div>
</header>
<main>
    <div class="slider">
        <!-- –ò–≥—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div id="gameModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('gameModal').style.display='none'">&times;</span>
        <div id="modalContent"></div>
    </div>
</div>
</body>
</html>
