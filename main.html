<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8T173410KK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-8T173410KK');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
  <link rel="stylesheet" href="styless-main.css">
  <link rel="icon" href="default_favicon.ico" type="image/x-icon">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="scripts/firebase-config.js"></script>
  <script src="scripts/user.js"></script>
  <script src="scripts/games.js"></script>
  <script src="scripts/modals.js"></script>
  <script src="scripts/auth.js"></script>

  <script>
    // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
    window.onload = function () {
      checkAuth()
              .then(() => {
                return loadUserData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
              })
              .then(() => {
                return loadGames(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–≥—Ä—ã
              })
              .catch((error) => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:', error);
              });
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    function openDepositModal() {
      const currentUser = localStorage.getItem('currentUser');
      if (currentUser) {
        document.getElementById('paymentModal').style.display = 'block';
      } else {
        alert('–î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.');
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    function closePaymentModal() {
      document.getElementById('paymentModal').style.display = 'none';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
    function displayWalletAddress() {
      const walletInfo = document.getElementById('walletInfo');
      walletInfo.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ—à–µ–ª—å–∫–µ
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã
    function confirmPayment() {
      const amount = document.getElementById('amount').value;
      const currentUser = localStorage.getItem('currentUser');

      if (amount && currentUser) {
        // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤ Firebase
        const paymentData = {
          user: currentUser,
          amount: parseFloat(amount),
          status: 'pending', // –°—Ç–∞—Ç—É—Å –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–∂–∏–¥–∞–Ω–∏–µ)
          timestamp: new Date().toISOString()
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤ –±–∞–∑—É
        firebase.database().ref('deposits/' + currentUser).push(paymentData)
                .then(() => {
                  alert(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ —Å—É–º–º—É ${amount} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –û–∂–∏–¥–∞–π—Ç–µ.`);
                  closePaymentModal(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                })
                .catch((error) => {
                  console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:', error);
                  alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                });
      } else if (!currentUser) {
        alert('–î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç.');
      } else {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.');
      }
    }
  </script>
</head>
<body>
<header>
  <img id="userAvatar" src="" alt="–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px;">
  <div id="username">Username: –ì–æ—Å—Ç—å</div>
  <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 üç∫</div>
  <div id="userCount">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: 0</div> <!-- –°—á—ë—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
  <button onclick="openDepositModal()" style="float: right; margin: 10px;">–î–µ–ø</button>
</header>
<main>
  <h2>Piv games</h2>
  <div id="gamesContainer" class="slider"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–≥—Ä -->
    <!-- –ò–≥—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
  </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞ -->
<div id="paymentModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="closePaymentModal()">&times;</span>
    <h2>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h2>
    <label for="amount">–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</label>
    <input type="number" id="amount" placeholder="–°—É–º–º–∞" />
    <button onclick="displayWalletAddress()">–í–Ω–µ—Å—Ç–∏</button>

    <div id="walletInfo" style="display:none;">
      <p>–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ TRC20 USDT:</p>
      <p id="walletAddress">TXYZ1234567890ABCDEFGH</p>
      <button onclick="confirmPayment()">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–≥—Ä -->
<div id="gameModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeGameModal()">&times;</span>
    <div id="modalContent"></div>
  </div>
</div>

</body>
</html>
